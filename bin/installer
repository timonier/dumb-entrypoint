#!/bin/sh
set -x

fail() {
    echo $1 1>&2
    echo "Usage: $0 [install|uninstall]" 1>&2
    exit 1
}

if [ $# -lt 1 ] ; then
    fail "Invalid number of arguments."
fi

if [ $(id -u) -ne 0 ] ; then
    fail "Impossible to prepare the system without root privileges."
fi

if [ $(uname) != "Linux" ] ; then
    fail "Impossible to prepare another operating system than Linux."
fi

case $1 in
    install )
        curl -sLo /usr/local/sbin/dumb-command "https://github.com/timonier/dumb-entrypoint/raw/master/src/dumb-command"
        chmod +x /usr/local/sbin/dumb-command

        curl -sLo /usr/local/sbin/dumb-init "https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64"
        chmod +x /usr/local/sbin/dumb-init

        curl -sLo /usr/local/sbin/gosu "https://github.com/tianon/gosu/releases/download/1.10/gosu-amd64"
        chmod +sx /usr/local/sbin/gosu
    ;;

    uninstall )
        rm -f /usr/local/sbin/dumb-command
        rm -f /usr/local/sbin/dumb-init
        rm -f /usr/local/sbin/gosu
    ;;

    * )
        fail "Argument $1 is invalid."
esac
